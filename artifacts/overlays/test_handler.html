<!doctype html><meta charset='utf-8'><title>test_handler – overlay</title><div style='max-width:980px;margin:24px auto'><h3 style='font-family:Inter,system-ui'>File: test_handler</h3><div><span style='padding:2px 6px;border-radius:10px;border:1px solid #888;margin-right:6px'>sast_risk: 0.55</span><span style='padding:2px 6px;border-radius:10px;border:1px solid #888;margin-right:6px'>ml_signal: 0.45</span><span style='padding:2px 6px;border-radius:10px;border:1px solid #888;margin-right:6px'>best_practice: 0.62</span></div><pre style='background:#0b1021;color:#ebedf5;padding:12px;border-radius:8px;overflow:auto;font-size:12px;line-height:1.4'>import os
import pickle
import shutil
import unittest
from qlib.tests import TestAutoData
from qlib.data import D
from qlib.data.dataset.handler import DataHandlerLP


class HandlerTests(TestAutoData):
    def to_str(self, obj):
        return "".join(str(obj).split())

    def test_handler_df(self):
        df = D.features(["sh600519"], start_time="20190101", end_time="20190201", fields=["$close"])
        dh = DataHandlerLP.from_df(df)
        print(dh.fetch())
        self.assertTrue(dh._data.equals(df))
        self.assertTrue(dh._infer is dh._data)
        self.assertTrue(dh._learn is dh._data)
        self.assertTrue(dh.data_loader._data is dh._data)
        fname = "_handler_test.pkl"
        dh.to_pickle(fname, dump_all=True)

        with open(fname, "rb") as f:
            dh_d = pickle.load(f)

        self.assertTrue(dh_d._data.equals(df))
        self.assertTrue(dh_d._infer is dh_d._data)
        self.assertTrue(dh_d._learn is dh_d._data)
        # Data loader will no longer be useful
        self.assertTrue("_data" not in dh_d.data_loader.__dict__.keys())
        os.remove(fname)


if __name__ == "__main__":
    unittest.main()
</pre><div style='color:#666;font-size:12px'>Threshold 0.50. Ticks on dashboard indicate predictions ≥ threshold.</div></div>